amends "../../configs/schema/servicebus-schema.pkl"

namespaces {
  new Namespace {
    namePrefix = "flashy-orders"
    options = new NamespaceOptions {
      sku = new Sku {
        name = "Standard"
      }
    }
    authorizations {
      new AuthorizationRule {
        name = "root"
        listen = true
        manage = true
        send = true
      }
    }
    topics {
      new Topic {
        name = "order-processing"
        authorizations {
          new AuthorizationRule {
            name = "orders"
            listen = true
            send = true
          }
        }
        subscriptions {
          new Subscription {
            name = "high-priority"
            options = new SubscriptionOptions {
              deadLetteringOnMessageExpiration = true
            }
            rules {
              new SubscriptionRule {
                rule_name = "high-priority-rule"
                filterType = "SqlFilter"
                sqlFilter = new RuleSqlFilter {
                  sqlExpression = "Priority = 'High'"
                }
              }
            }
          }
          new Subscription {
            name = "normal-priority"
            options = new SubscriptionOptions {
              deadLetteringOnMessageExpiration = true
            }
            rules {
              new SubscriptionRule {
                rule_name = "normal-priority-rule"
                filterType = "SqlFilter"
                sqlFilter = new RuleSqlFilter {
                  sqlExpression = "Priority = 'Normal'"
                }
              }
            }
          }
        }
      }
    }
    queues {
      new Queue {
        name = "orders"
        options = new QueueOptions {
          deadLetteringOnMessageExpiration = true
        }
        authorizations {
          new AuthorizationRule {
            name = "orders"
            listen = true
            manage = true
            send = true
          }
        }
      }
    }
  }
}
